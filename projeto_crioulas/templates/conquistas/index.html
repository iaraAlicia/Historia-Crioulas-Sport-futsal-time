{% extends 'base.html' %}
{% load static %}

{% block title %}Conquistas - Crioulas FC{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/conquistas.css' %}">
{% endblock %}

{% block content %}

    <div class="fixed-background" style="background-image: url('{% static 'img/bg-campo.jpg' %}');"></div>

    <div class="main-container">
        
        <div class="wheel-wrapper">
            <div class="curved-line"></div>
            
            <div class="wheel-list" id="wheel-list">
                {% for item in conquistas %}
                    <div class="wheel-item" 
                         onclick="selectYear({{ forloop.counter0 }})"
                         data-index="{{ forloop.counter0 }}"
                         data-titulo="{{ item.titulo }}"
                         data-desc="{{ item.descricao }}"
                         /* AQUI ESTAVA O ERRO: Agora pega a URL certa do upload */
                         data-img="{{ item.imagem.url }}">
                        {{ item.ano }}
                    </div>
                {% endfor %}
            </div>
            
            <div class="controls">
                <button onclick="move(-1)">▲</button>
                <button onclick="move(1)">▼</button>
            </div>
        </div>

        <div class="player-column">
            <img id="player-img" src="" alt="Destaque" class="player-cutout">
        </div>

        <div class="content-column">
            <h3 class="category-tag">#TRAJETÓRIA</h3>
            <h1 id="display-title" class="main-title">...</h1>
            <p id="display-desc" class="description">...</p>
            <div class="stats-box">CONCEIÇÃO DAS CRIOULAS</div>
        </div>
    </div>

    <script>
        let currentIndex = 0;
        const items = document.querySelectorAll('.wheel-item');
        const totalItems = items.length;

        // Inicia selecionando o último ano (mais recente)
        if (totalItems > 0) {
            selectYear(totalItems - 1);
        }

        function selectYear(index) {
            currentIndex = index;
            updateWheel();
        }

        function move(direction) {
            let newIndex = currentIndex + direction;
            if (newIndex >= 0 && newIndex < totalItems) {
                selectYear(newIndex);
            }
        }

        function updateWheel() {
            const titleEl = document.getElementById('display-title');
            const descEl = document.getElementById('display-desc');
            
            // AGORA PEGAMOS A TAG <IMG> DO MEIO, NÃO O FUNDO
            const playerImg = document.getElementById('player-img');

            items.forEach((item, i) => {
                const distance = i - currentIndex;
                
                // Reseta classes
                item.className = 'wheel-item';

                if (distance === 0) {
                    item.classList.add('active');
                    
                    // Atualiza Texto
                    titleEl.innerText = item.getAttribute('data-titulo');
                    descEl.innerText = item.getAttribute('data-desc');
                    
                    // Atualiza a Imagem Central com animação de troca
                    const newSrc = item.getAttribute('data-img');
                    
                    // Só troca se a imagem for diferente (evita piscar)
                    if (playerImg.src !== newSrc && newSrc) {
                        playerImg.style.opacity = 0; // Some suavemente
                        playerImg.style.transform = 'scale(0.9)'; // Encolhe
                        
                        setTimeout(() => {
                            playerImg.src = newSrc;
                            playerImg.style.opacity = 1; // Aparece
                            playerImg.style.transform = 'scale(1)'; // Cresce
                        }, 300);
                    } 
                    // Se for a primeira vez que carrega
                    else if (playerImg.getAttribute('src') === "") {
                        playerImg.src = newSrc;
                        playerImg.style.opacity = 1;
                    }

                } else if (distance === -1) {
                    item.classList.add('prev-1');
                } else if (distance === -2) {
                    item.classList.add('prev-2');
                } else if (distance === 1) {
                    item.classList.add('next-1');
                } else if (distance === 2) {
                    item.classList.add('next-2');
                } else {
                    item.classList.add('hidden');
                }
            });
        }
    </script>

{% endblock %}